!function(){let e=window.location.hostname;if("localhost"===e||"127.0.0.1"===e||""===e){"file:"===window.location.protocol&&t();return}function t(){throw document.body.innerHTML=`
				<div style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; background:#0f172a; color:white; font-family:sans-serif; text-align:center;">
					<h1 style="font-size:3rem; color:#ef4444;">â›” AKSES DITOLAK</h1>
					<p style="font-size:1.2rem; margin-top:1rem;">Aplikasi ini dilindungi Hak Cipta dan hanya dapat digunakan melalui website resmi.</p>
					<a href="https://ariestechlab.com" style="margin-top:2rem; padding:10px 20px; background:#10b981; color:white; text-decoration:none; border-radius:8px; font-weight:bold;">Buka Aries Tech Labs</a>
				</div>
			`,Error("Illegal execution environment detected.")}["ariestechlab.com","www.ariestechlab.com"].includes(e)||t()}();let originalFile=null,baseImage=null,compressedBlob=null,cropper=null,editState={rotation:0,flipH:1,grayscale:!1},isAutoMode=!0,debounceTimer;const dropZone=document.getElementById("drop-zone"),fileInput=document.getElementById("file-input"),previewImg=document.getElementById("preview-img"),loading=document.getElementById("loading");function startCrop(){cropper||(document.getElementById("editor-panel").classList.add("pointer-events-none","opacity-50"),document.getElementById("crop-actions").classList.remove("hidden"),cropper=new Cropper(previewImg,{viewMode:1,dragMode:"move",autoCropArea:.8,background:!1,ready(){}}))}function applyCrop(){if(!cropper)return;let e=cropper.getCroppedCanvas();(baseImage=new Image).onload=()=>{endCrop(),processImage()},baseImage.src=e.toDataURL()}function cancelCrop(){endCrop(),processImage()}function endCrop(){cropper&&(cropper.destroy(),cropper=null),document.getElementById("editor-panel").classList.remove("pointer-events-none","opacity-50"),document.getElementById("crop-actions").classList.add("hidden")}function resetImage(){originalFile&&handleFile(originalFile)}function rotate(e){editState.rotation=(editState.rotation+e)%360,processImage()}function flip(e){"h"===e&&(editState.flipH*=-1),processImage()}function toggleGrayscale(){editState.grayscale=!editState.grayscale;let e=document.getElementById("btn-gray");editState.grayscale?e.classList.add("btn-tool-active"):e.classList.remove("btn-tool-active"),processImage()}function handleFile(e){if(!e.type.match("image.*")){alert("Hanya file gambar!");return}originalFile=e,document.getElementById("orig-size").innerText=formatBytes(e.size);let t=new FileReader;t.onload=e=>{(baseImage=new Image).onload=()=>{document.getElementById("empty-state").classList.add("hidden"),document.getElementById("editor-panel").classList.remove("hidden"),document.getElementById("download-btn").classList.remove("hidden"),previewImg.classList.remove("hidden"),editState={rotation:0,flipH:1,grayscale:!1},document.getElementById("btn-gray").classList.remove("btn-tool-active"),processImage()},baseImage.src=e.target.result},t.readAsDataURL(e)}async function processImage(){if(!baseImage)return;loading.classList.remove("hidden"),await new Promise(e=>setTimeout(e,50));let e=document.getElementById("format").value,t=document.createElement("canvas"),a=t.getContext("2d"),n=editState.rotation*Math.PI/180,o=Math.abs(Math.sin(n)),i=Math.abs(Math.cos(n)),l=isAutoMode?1:parseInt(document.getElementById("scale").value)/100,r=baseImage.width*l,s=baseImage.height*l;t.width=r*i+s*o,t.height=r*o+s*i,a.save(),editState.grayscale&&(a.filter="grayscale(100%)"),a.translate(t.width/2,t.height/2),a.rotate(n),a.scale(editState.flipH,1),a.drawImage(baseImage,-r/2,-s/2,r,s),a.restore();let d=null;if(isAutoMode){let c=parseInt(document.getElementById("target-size").value)||200,g=1024*c,m=0,p=1,u=.8;for(let f=0;f<5;f++){u=(m+p)/2;let y=await new Promise(a=>t.toBlob(a,e,u));y.size>g?p=u:(m=u,d=y)}(!d||d.size>g)&&(d=await new Promise(a=>t.toBlob(a,e,.5)))}else{let I=parseInt(document.getElementById("quality").value)/100;d=await new Promise(a=>t.toBlob(a,e,I))}updateResult(d),loading.classList.add("hidden")}function updateResult(e){compressedBlob=e;let t=formatBytes(e.size);document.getElementById("new-size").innerText=t,document.getElementById("final-size-badge").innerText=t;let a=document.getElementById("new-size");e.size<originalFile.size?a.className="text-emerald-400 font-bold":a.className="text-rose-400 font-bold",previewImg.src=URL.createObjectURL(e)}function toggleAutoMode(){isAutoMode=document.getElementById("auto-mode").checked;let e=document.getElementById("manual-controls");isAutoMode?(e.classList.add("opacity-50","pointer-events-none"),processImage()):e.classList.remove("opacity-50","pointer-events-none")}function updateVal(e,t){document.getElementById(e).innerText=t}function downloadImage(){if(!compressedBlob)return;let e=document.createElement("a");e.href=URL.createObjectURL(compressedBlob);let t="jpg";"image/png"===document.getElementById("format").value&&(t="png"),"image/webp"===document.getElementById("format").value&&(t="webp");let a=originalFile.name.split(".")[0];e.download=`${a}_edited.${t}`,e.click()}function formatBytes(e){if(!+e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return`${parseFloat((e/Math.pow(1024,t)).toFixed(2))} ${["Bytes","KB","MB","GB"][t]}`}dropZone.addEventListener("dragover",e=>{e.preventDefault(),dropZone.classList.add("drag-active")}),dropZone.addEventListener("dragleave",()=>dropZone.classList.remove("drag-active")),dropZone.addEventListener("drop",e=>{e.preventDefault(),dropZone.classList.remove("drag-active"),e.dataTransfer.files.length&&handleFile(e.dataTransfer.files[0])}),fileInput.addEventListener("change",e=>{e.target.files.length&&handleFile(e.target.files[0])}),document.getElementById("target-size").addEventListener("input",()=>{clearTimeout(debounceTimer),debounceTimer=setTimeout(()=>{isAutoMode&&processImage()},500)}),document.addEventListener("DOMContentLoaded",()=>{initSessionManager()});