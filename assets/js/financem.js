!function(){let e=window.location.hostname;if("localhost"===e||"127.0.0.1"===e||""===e){"file:"===window.location.protocol&&t();return}function t(){throw document.body.innerHTML=`
					<div style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; background:#0f172a; color:white; font-family:sans-serif; text-align:center;">
						<h1 style="font-size:3rem; color:#ef4444;">â›” AKSES DITOLAK</h1>
						<p style="font-size:1.2rem; margin-top:1rem;">Aplikasi ini dilindungi Hak Cipta dan hanya dapat digunakan melalui website resmi.</p>
						<a href="https://ariestechlab.com" style="margin-top:2rem; padding:10px 20px; background:#10b981; color:white; text-decoration:none; border-radius:8px; font-weight:bold;">Buka Aries Tech Labs</a>
					</div>
				`,Error("Illegal execution environment detected.")}["ariestechlab.com","www.ariestechlab.com"].includes(e)||t()}();const STORAGE_KEY="ariesFinFlowData_v1";let appData={books:[{id:"book_default",name:"Dompet Utama"}],activeBookId:"book_default",transactions:[]};const CATEGORIES={in:["Gaji","Bonus/Tunjangan","Penjualan","Investasi","Lainnya Masuk"],out:["Makan & Minum","Transportasi","Tempat Tinggal","Tagihan & Utilitas","Belanja Kebutuhan","Hiburan","Kesehatan","Pendidikan","Amal/Donasi","Lainnya Keluar"]};let expenseChartInstance=null;const formatIDR=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e),getTodayDateString=()=>new Date().toISOString().split("T")[0],generateId=()=>Date.now().toString(36)+Math.random().toString(36).substr(2);function loadData(){let e=localStorage.getItem(STORAGE_KEY);if(e)try{if(!(appData=JSON.parse(e)).books||!appData.transactions)throw Error("Struktur data tidak valid");updateUI()}catch(t){console.error("Data korup, reset ke default:",t),saveData()}else saveData()}const SESSION_DURATION=144e5;function checkSessionValidity(){let e=localStorage.getItem("aries_session_timestamp"),t=new Date().getTime();e||(e=t,localStorage.setItem("aries_session_timestamp",t));let a=t-parseInt(e);return!(a>144e5)||(confirm("âš ï¸ SESI BERAKHIR\n\nDemi keamanan data dan pembaruan sistem, aplikasi perlu dimuat ulang setiap 24 jam.\n\nKlik OK untuk Refresh halaman sekarang.")&&(localStorage.setItem("aries_session_timestamp",t),location.reload()),!1)}function saveData(){checkSessionValidity()&&(localStorage.setItem(STORAGE_KEY,JSON.stringify(appData)),updateUI())}function getActiveTransactions(){return appData.transactions.filter(e=>e.bookId===appData.activeBookId).sort((e,t)=>new Date(t.date)-new Date(e.date))}function updateUI(){let e=document.getElementById("bookSelector");e.innerHTML=appData.books.map(e=>`<option value="${e.id}" ${e.id===appData.activeBookId?"selected":""}>ðŸ“˜ ${e.name}</option>`).join("");let t=getActiveTransactions(),a=0,n=0;t.forEach(e=>{"in"===e.type?a+=Number(e.amount):n+=Number(e.amount)}),document.getElementById("totalIncomeDisplay").innerText=formatIDR(a),document.getElementById("totalExpenseDisplay").innerText=formatIDR(n),document.getElementById("balanceDisplay").innerText=formatIDR(a-n),renderTable(t),renderExpenseChart(t)}function renderTable(e){let t=document.getElementById("transactionTableBody"),a=document.getElementById("emptyRowState");if(0===e.length){t.innerHTML="",t.appendChild(a),a.classList.remove("hidden");return}a.classList.add("hidden"),t.innerHTML=e.map(e=>{let t="in"===e.type,a=new Date(e.date).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"2-digit"});return`
                    <tr class="hover:bg-slate-800/30 transition-colors group">
                        <td class="px-5 py-3 font-mono text-xs whitespace-nowrap">${a}</td>
                        <td class="px-5 py-3">
                            <div class="flex items-center gap-3">
                                <div class="w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center shrink-0 border border-slate-700">
                                    <i class="fa-solid ${t?"fa-arrow-down-long text-emerald-500":"fa-arrow-up-long text-rose-500"} text-xs"></i>
                                </div>
                                <div>
                                    <div class="font-bold text-slate-200">${e.category}</div>
                                    ${e.note?`<div class="text-xs text-slate-500 italic truncate max-w-[200px]">${e.note}</div>`:""}
                                </div>
                            </div>
                        </td>
                        <td class="px-5 py-3 text-right font-mono font-bold ${t?"text-emerald-400":"text-rose-400"}">
                            ${t?"+":"-"} ${formatIDR(e.amount).replace("Rp","")}
                        </td>
                         <td class="px-5 py-3 text-center">
                            <button onclick="deleteTransaction('${e.id}')" class="text-slate-600 hover:text-rose-500 transition-colors p-2 rounded hover:bg-rose-500/10 opacity-0 group-hover:opacity-100" title="Hapus Transaksi">
                                <i class="fa-solid fa-trash-can"></i>
                            </button>
                        </td>
                    </tr>
                `}).join("")}function renderExpenseChart(e){let t=document.getElementById("expenseChart"),a=document.getElementById("chartEmptyState"),n=new Date,o=e.filter(e=>{let t=new Date(e.date);return"out"===e.type&&t.getMonth()===n.getMonth()&&t.getFullYear()===n.getFullYear()});if(0===o.length){t.classList.add("hidden"),a.classList.remove("hidden"),expenseChartInstance&&expenseChartInstance.destroy();return}t.classList.remove("hidden"),a.classList.add("hidden");let i={};o.forEach(e=>i[e.category]=(i[e.category]||0)+Number(e.amount)),expenseChartInstance&&expenseChartInstance.destroy(),expenseChartInstance=new Chart(t,{type:"doughnut",data:{labels:Object.keys(i),datasets:[{data:Object.values(i),backgroundColor:["#f43f5e","#ec4899","#d946ef","#a855f7","#8b5cf6","#6366f1","#3b82f6","#0ea5e9","#06b6d4","#14b8a6"],borderWidth:0,hoverOffset:10}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{color:"#94a3b8",font:{size:10},boxWidth:12}},tooltip:{callbacks:{label:e=>`${e.label}: ${formatIDR(e.raw)}`}}},cutout:"70%"}})}function updateCategoryOptions(){let e=document.querySelector('input[name="type"]:checked').value;document.getElementById("inputCategory").innerHTML=CATEGORIES[e].map(e=>`<option value="${e}">${e}</option>`).join("")}function createNewBook(){let e=prompt("Nama buku baru:");if(e&&""!==e.trim()){let t=generateId();appData.books.push({id:t,name:e.trim()}),appData.activeBookId=t,saveData()}}function deleteTransaction(e){confirm("Hapus transaksi ini?")&&(appData.transactions=appData.transactions.filter(t=>t.id!==e),saveData())}function clearCurrentBookData(){confirm("Hapus SEMUA data di buku ini?")&&(appData.transactions=appData.transactions.filter(e=>e.bookId!==appData.activeBookId),saveData())}function getFilteredExportData(){let e=getActiveTransactions(),t=document.getElementById("exportMonthPicker").value;if(0===e.length)return alert("Tidak ada data transaksi di buku ini."),null;let a="Semua Periode";if(t){let[n,o]=t.split("-");e=e.filter(e=>{let t=new Date(e.date);return t.getFullYear()===parseInt(n)&&t.getMonth()+1===parseInt(o)});let i=new Date(n,o-1);if(a=i.toLocaleDateString("id-ID",{month:"long",year:"numeric"}),0===e.length)return alert(`Tidak ada data transaksi pada periode ${a}.`),null}let r=0,s=0;return e.forEach(e=>{"in"===e.type?r+=Number(e.amount):s+=Number(e.amount)}),{transactions:e,periodeLabel:a,totalIn:r,totalOut:s,balance:r-s}}function exportToExcel(){let e=getFilteredExportData();if(!e)return;let{transactions:t,periodeLabel:a,totalIn:n,totalOut:o,balance:i}=e,r=t.map(e=>({Tanggal:e.date,Tipe:"in"===e.type?"Pemasukan":"Pengeluaran",Kategori:e.category,Catatan:e.note||"-",Jumlah:e.amount}));r.push({Tanggal:"",Tipe:"",Kategori:"",Catatan:"",Jumlah:""},{Tanggal:"RINGKASAN",Tipe:"",Kategori:"",Catatan:"Total Pemasukan",Jumlah:n},{Tanggal:"",Tipe:"",Kategori:"",Catatan:"Total Pengeluaran",Jumlah:o},{Tanggal:"",Tipe:"",Kategori:"",Catatan:"SISA SALDO",Jumlah:i});let s=XLSX.utils.json_to_sheet(r),l=XLSX.utils.book_new();s["!cols"]=[{wch:12},{wch:12},{wch:20},{wch:30},{wch:15}],XLSX.utils.book_append_sheet(l,s,"Laporan");let d=appData.books.find(e=>e.id===appData.activeBookId).name.replace(/\s+/g,"_"),p=a.replace(/\s+/g,"_");XLSX.writeFile(l,`FinFlow_${d}_${p}.xlsx`)}function exportToPDF(){let e=getFilteredExportData();if(!e)return;let{transactions:t,periodeLabel:a,totalIn:n,totalOut:o,balance:i}=e,{jsPDF:r}=window.jspdf,s=new r,l=appData.books.find(e=>e.id===appData.activeBookId).name;s.setFillColor(15,23,42),s.rect(0,0,210,40,"F"),s.setTextColor(255,255,255),s.setFontSize(18),s.text(`Laporan Keuangan: ${l}`,14,18),s.setFontSize(10),s.setTextColor(148,163,184),s.text(`Periode Laporan: ${a}`,14,26),s.text(`Dicetak pada: ${new Date().toLocaleString("id-ID")}`,14,32),s.setTextColor(0,0,0),s.setFontSize(10),s.text("Total Pemasukan",14,50),s.setTextColor(16,185,129),s.setFontSize(12),s.setFont(void 0,"bold"),s.text(formatIDR(n),14,56),s.setFont(void 0,"normal"),s.setTextColor(0,0,0),s.setFontSize(10),s.text("Total Pengeluaran",80,50),s.setTextColor(244,63,94),s.setFontSize(12),s.setFont(void 0,"bold"),s.text(formatIDR(o),80,56),s.setFont(void 0,"normal"),s.setTextColor(0,0,0),s.setFontSize(10),s.text("Saldo Akhir",150,50),s.setTextColor(67,56,202),s.setFontSize(12),s.setFont(void 0,"bold"),s.text(formatIDR(i),150,56),s.autoTable({head:[["Tanggal","Tipe","Kategori","Catatan","Jumlah"]],body:t.map(e=>[e.date,"in"===e.type?"Masuk":"Keluar",e.category,e.note||"",formatIDR(e.amount).replace("Rp","").trim()]),startY:65,theme:"grid",styles:{fontSize:9,cellPadding:3},headStyles:{fillColor:[30,41,59],textColor:255},columnStyles:{4:{halign:"right",fontStyle:"bold"}},didParseCell:function(e){"body"===e.section&&1===e.column.index&&(e.cell.styles.textColor="Masuk"===e.cell.raw?[16,185,129]:[244,63,94])}});let d=s.internal.getNumberOfPages();s.setFontSize(8),s.setTextColor(150),s.text(`Halaman 1 dari ${d} | Dibuat dengan Aries FinFlow`,14,s.internal.pageSize.height-10),s.save(`Laporan_${l}_${a.replace(/\s+/g,"_")}.pdf`)}document.getElementById("bookSelector").addEventListener("change",e=>{appData.activeBookId=e.target.value,saveData()}),document.querySelectorAll('input[name="type"]').forEach(e=>{e.addEventListener("change",updateCategoryOptions)}),document.getElementById("transactionForm").addEventListener("submit",e=>{e.preventDefault();let t=document.getElementById("inputAmount"),a=document.getElementById("inputDate");if(!t.value||!a.value)return alert("Jumlah dan Tanggal wajib diisi!");appData.transactions.unshift({id:generateId(),bookId:appData.activeBookId,type:document.querySelector('input[name="type"]:checked').value,amount:Number(t.value),date:a.value,category:document.getElementById("inputCategory").value,note:document.getElementById("inputNote").value.trim()}),saveData(),e.target.reset(),a.value=getTodayDateString(),updateCategoryOptions()}),document.addEventListener("DOMContentLoaded",()=>{document.getElementById("inputDate").value=getTodayDateString(),updateCategoryOptions(),loadData(),localStorage.setItem("aries_session_timestamp",new Date().getTime())});