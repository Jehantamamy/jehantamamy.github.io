!function(){let e=window.location.hostname;if("localhost"===e||"127.0.0.1"===e||""===e){"file:"===window.location.protocol&&t();return}function t(){throw document.body.innerHTML=`
					<div style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh; background:#0f172a; color:white; font-family:sans-serif; text-align:center;">
						<h1 style="font-size:3rem; color:#ef4444;">‚õî AKSES DITOLAK</h1>
						<p style="font-size:1.2rem; margin-top:1rem;">Aplikasi ini dilindungi Hak Cipta dan hanya dapat digunakan melalui website resmi.</p>
						<a href="https://ariestechlab.com" style="margin-top:2rem; padding:10px 20px; background:#10b981; color:white; text-decoration:none; border-radius:8px; font-weight:bold;">Buka Aries Tech Labs</a>
					</div>
				`,Error("Illegal execution environment detected.")}["ariestechlab.com","www.ariestechlab.com"].includes(e)||t()}();const GOOGLE_SCRIPT_URL="https://script.google.com/macros/s/AKfycbyd2uLg7i5PCr23Lw0c7EHdRU6iBCzeTu3s4ilX8P13idY90sFvbW2v9vRY7GwxW1-RuQ/exec";let activeMeeting=null,customFields=[],reportData=[],savedLogoBase64="";function switchMode(e){document.getElementById("view-admin").classList.toggle("hidden","admin"!==e),document.getElementById("view-peserta").classList.toggle("hidden","peserta"!==e),document.getElementById("view-laporan").classList.toggle("hidden","laporan"!==e);let t="flex-1 py-3 text-xs md:text-sm font-bold border-b-2 transition-colors ",n="flex-1 py-3 text-xs md:text-sm font-bold text-slate-500 hover:text-slate-300 border-b-2 border-transparent transition-colors";document.getElementById("tab-admin").className="admin"===e?t+"text-sky-400 border-sky-400":n,document.getElementById("tab-peserta").className="peserta"===e?t+"text-emerald-400 border-emerald-400":n,document.getElementById("tab-laporan").className="laporan"===e?t+"text-rose-400 border-rose-400":n}function saveAdminState(){let e={name:document.getElementById("agendaName").value,location:document.getElementById("agendaLocation").value,date:document.getElementById("agendaDate").value,time:document.getElementById("agendaTime").value,instansi:document.getElementById("fieldInstansi").checked,dept:document.getElementById("fieldDept").checked,phone:document.getElementById("fieldPhone").checked,signature:document.getElementById("fieldSignature").checked,customFields:customFields,logo:savedLogoBase64};localStorage.setItem("pentol_draft",JSON.stringify(e))}function loadAdminState(){let e=localStorage.getItem("pentol_draft");if(e)try{let t=JSON.parse(e);t.name&&(document.getElementById("agendaName").value=t.name),t.location&&(document.getElementById("agendaLocation").value=t.location),t.date?document.getElementById("agendaDate").value=t.date:document.getElementById("agendaDate").valueAsDate=new Date,t.time&&(document.getElementById("agendaTime").value=t.time),void 0!==t.instansi&&(document.getElementById("fieldInstansi").checked=t.instansi),void 0!==t.dept&&(document.getElementById("fieldDept").checked=t.dept),void 0!==t.phone&&(document.getElementById("fieldPhone").checked=t.phone),void 0!==t.signature&&(document.getElementById("fieldSignature").checked=t.signature),t.customFields&&(customFields=t.customFields,renderAdminFieldList()),t.logo&&(savedLogoBase64=t.logo,document.getElementById("logoPreview").src=t.logo,document.getElementById("logoPreviewContainer").classList.remove("hidden"))}catch(n){}else document.getElementById("agendaDate").valueAsDate=new Date}function handleLogoUpload(e){let t=e.files[0];if(!t)return;if(t.size>2097152)return alert("Ukuran logo terlalu besar! Maksimal 2MB.");let n=new FileReader;n.onload=function(e){savedLogoBase64=e.target.result,document.getElementById("logoPreview").src=savedLogoBase64,document.getElementById("logoPreviewContainer").classList.remove("hidden"),saveAdminState()},n.readAsDataURL(t)}function removeLogo(){savedLogoBase64="",document.getElementById("logoUpload").value="",document.getElementById("logoPreviewContainer").classList.add("hidden"),saveAdminState()}function toggleOptionsInput(){document.getElementById("cf-options-container").classList.toggle("hidden","text"===document.getElementById("cf-type").value)}function addCustomField(){let e=document.getElementById("cf-label").value.trim(),t=document.getElementById("cf-type").value,n=document.getElementById("cf-options").value.trim();return e?"text"===t||n?void(customFields.push({label:e,type:t,options:"text"!==t?n.split(",").map(e=>e.trim()):[]}),document.getElementById("cf-label").value="",document.getElementById("cf-options").value="",renderAdminFieldList(),saveAdminState()):alert("Opsi wajib diisi!"):alert("Pertanyaan wajib diisi!")}function renderAdminFieldList(){let e=document.getElementById("custom-fields-list");e.innerHTML="",customFields.forEach((t,n)=>{e.innerHTML+=`<div class="flex justify-between items-center p-2 bg-slate-900 border border-slate-700 rounded-lg"><div><p class="text-xs text-white font-bold">${t.label}</p><p class="text-[9px] text-sky-400">${t.type}</p></div><button onclick="removeField(${n})" class="text-rose-500 text-xs font-bold px-2">&times;</button></div>`})}function removeField(e){customFields.splice(e,1),renderAdminFieldList(),saveAdminState()}function generateMeetingCode(){let e=document.querySelector('#view-admin button[onclick="generateMeetingCode()"]');e.innerText="Membuat Ruangan... ‚è≥",e.disabled=!0;let t=Date.now().toString(36).slice(-3).toUpperCase(),n=Math.random().toString(36).substring(2,5).toUpperCase(),a=Math.random().toString(36).substring(2,5).toUpperCase(),i={action:"createMeeting",code:"JOIN-"+n+t,adminCode:"ADMIN-"+a+t,name:document.getElementById("agendaName").value||"Rapat Internal",location:document.getElementById("agendaLocation").value||"-",date:document.getElementById("agendaDate").value||"-",time:document.getElementById("agendaTime").value||"-",quickFields:{instansi:document.getElementById("fieldInstansi").checked,dept:document.getElementById("fieldDept").checked,phone:document.getElementById("fieldPhone").checked,signature:document.getElementById("fieldSignature").checked},customFields:[...customFields]};fetch(GOOGLE_SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify(i)}).then(e=>e.json()).then(e=>{activeMeeting=i;let a=i.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").substring(0,20);a.endsWith("-")&&(a=a.slice(0,-1));let l=(n+t).toLowerCase(),d=window.location.href.split("?")[0].split("#")[0].replace(/pentol\.html$/,"");d.endsWith("/")||(d+="/");let s=`${d}#${a}-${l}`;document.getElementById("display-magic-link").value=s,document.getElementById("display-admin-code").innerText=i.adminCode,document.getElementById("code-result").classList.replace("hidden","flex")}).catch(e=>alert("Gagal konek ke Server! Pastikan URL Web App benar.")).finally(()=>{e.innerText="Generate Ruangan Rapat",e.disabled=!1})}function copyCode(e,t,n=!1){let a=n?document.getElementById(e).value:document.getElementById(e).innerText;navigator.clipboard.writeText(a).then(()=>{let e=document.getElementById(t),n=e.innerHTML,a=e.className;e.innerHTML=`‚úîÔ∏è Tersalin!`,e.className=a.replace(/bg-\w+-600/,"bg-sky-600"),setTimeout(()=>{e.innerHTML=n,e.className=a},1500)})}function shareViaEmail(){if(!activeMeeting)return;let e=document.getElementById("display-magic-link").value,t=encodeURIComponent(`Undangan & Backup Presensi: ${activeMeeting.name}`),n=encodeURIComponent(`Halo,

Silakan mengisi presensi kehadiran untuk agenda rapat berikut:

üìå Agenda  : ${activeMeeting.name}
üìç Tempat  : ${activeMeeting.location||"-"}
üìÖ Tanggal : ${activeMeeting.date}
‚è∞ Waktu   : ${activeMeeting.time}

Klik link otomatis di bawah ini untuk langsung mengisi form absen:
${e}

Atau masuk manual menggunakan kode peserta: ${activeMeeting.code}

Terima kasih.

========================================
üîí KHUSUS PANITIA (HAPUS JIKA DIKIRIM KE PESERTA)
Simpan email ini sebagai backup akses Anda.
Kode Laporan (Admin): ${activeMeeting.adminCode}
========================================`),a=`https://mail.google.com/mail/?view=cm&fs=1&to=&su=${t}&body=${n}`;window.open(a,"_blank")}function verifyCode(e=!1){let t=document.querySelector(`#${e?"screen-enter-admin-code":"screen-enter-code"} button`),n=document.getElementById(e?"inputAdminCode":"inputMeetingCode").value.toUpperCase().trim();if(!n)return alert("Masukkan kode dulu!");let a=t.innerText;t.innerText="Mencari Presensi... ‚è≥",t.disabled=!0,fetch(GOOGLE_SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"getMeeting",code:n})}).then(e=>e.json()).then(t=>{if("success"===t.status){if(activeMeeting=t.meeting,e){if(n!==activeMeeting.adminCode)return alert("Itu kode Join Peserta, bukan kode Laporan!");document.getElementById("screen-enter-admin-code").classList.add("hidden"),document.getElementById("screen-dashboard").classList.remove("hidden"),document.getElementById("dash-agenda-name").innerText=activeMeeting.name,document.getElementById("dash-meeting-code").innerText=activeMeeting.code,fetchDashboardData()}else{if(n!==activeMeeting.code)return alert("Itu kode Laporan Admin, bukan kode Join!");renderFormPeserta()}}else alert("Kode Presensi tidak ditemukan di database!")}).catch(e=>alert("Gagal konek ke Server!")).finally(()=>{t.innerText=a,t.disabled=!1})}function verifyAdminCode(){verifyCode(!0)}function renderFormPeserta(){document.getElementById("screen-enter-code").classList.add("hidden"),document.getElementById("screen-attendance").classList.remove("hidden"),document.getElementById("display-agenda-name").innerText=activeMeeting.name,document.getElementById("display-agenda-location").innerText=activeMeeting.location||"-",document.getElementById("display-agenda-date").innerText=activeMeeting.date,document.getElementById("display-agenda-time").innerText=activeMeeting.time;let e=document.getElementById("dynamic-form");e.innerHTML=renderInputHtml("Nama Lengkap","text","Masukkan nama","inp-NamaLengkap"),activeMeeting.quickFields.instansi&&(e.innerHTML+=renderInputHtml("Instansi","text","Asal instansi","inp-Instansi")),activeMeeting.quickFields.dept&&(e.innerHTML+=renderInputHtml("Departemen","text","Posisi","inp-Dept")),activeMeeting.quickFields.phone&&(e.innerHTML+=renderInputHtml("WhatsApp","tel","0812...","inp-Phone")),activeMeeting.customFields.forEach(t=>{let n="text"===t.type?`<input type="text" name="${t.label}" class="w-full p-2.5 bg-slate-900 border border-slate-700 rounded-lg text-white text-sm focus:border-emerald-500 outline-none dynamic-inp">`:"dropdown"===t.type?`<select name="${t.label}" class="w-full p-2.5 bg-slate-900 border border-slate-700 rounded-lg text-white text-sm focus:border-emerald-500 outline-none dynamic-inp"><option disabled selected>-- Pilih --</option>${t.options.map(e=>`<option>${e}</option>`).join("")}</select>`:`<div class="space-y-2 p-3 bg-slate-900 border border-slate-700 rounded-lg">${t.options.map(e=>`<label class="flex items-center gap-2"><input type="radio" name="${t.label}" value="${e}" class="dynamic-inp-radio"><span class="text-sm text-slate-300">${e}</span></label>`).join("")}</div>`;e.innerHTML+=`<div><label class="block text-[10px] text-emerald-400 font-bold uppercase tracking-widest mb-1">${t.label} *</label>${n}</div>`});let t=document.getElementById("signature-section");activeMeeting.quickFields.signature?(t.classList.remove("hidden"),setTimeout(resizeCanvas,50)):t.classList.add("hidden")}function renderInputHtml(e,t,n,a){return`<div><label class="block text-[10px] text-emerald-400 font-bold uppercase tracking-widest mb-1">${e} *</label><input type="${t}" id="${a}" name="${e}" placeholder="${n}" class="w-full p-2.5 bg-slate-900 border border-slate-700 rounded-lg text-white text-sm focus:border-emerald-500 outline-none dynamic-inp"></div>`}function submitAttendance(){let e=document.getElementById("btn-submit"),t=e.innerHTML;if(!document.getElementById("inp-NamaLengkap").value.trim())return alert("Nama wajib diisi!");let n={};document.querySelectorAll(".dynamic-inp").forEach(e=>{"inp-NamaLengkap"!==e.id&&e.value&&(n[e.name]=e.value)}),document.querySelectorAll(".dynamic-inp-radio:checked").forEach(e=>n[e.name]=e.value);let a={action:"submitAttendance",kodeRapat:activeMeeting.code,namaPeserta:document.getElementById("inp-NamaLengkap").value,formLain:n,tandaTangan:activeMeeting.quickFields.signature?canvas.toDataURL():"NO TTD"};e.innerHTML="Mengirim Data... ‚è≥",e.disabled=!0,fetch(GOOGLE_SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify(a)}).then(e=>e.json()).then(e=>{document.getElementById("screen-attendance").classList.add("hidden"),document.getElementById("screen-success").classList.remove("hidden"),alert("‚úÖ BERHASIL! Presensi tersimpan.")}).catch(()=>{document.getElementById("screen-attendance").classList.add("hidden"),document.getElementById("screen-success").classList.remove("hidden"),alert("‚úÖ BERHASIL! Presensi tersimpan.")}).finally(()=>{e.innerHTML=t,e.disabled=!1,clearCanvas()})}function fetchDashboardData(){let e=document.getElementById("dashboard-list");e.innerHTML='<p class="text-xs text-sky-400 text-center py-2">Menarik data server... ‚è≥</p>',fetch(GOOGLE_SCRIPT_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify({action:"getReport",kodeRapat:activeMeeting.code})}).then(e=>e.json()).then(t=>{"success"===t.status&&(reportData=t.data,document.getElementById("dashboard-count").innerText=reportData.length+" Hadir",e.innerHTML=0===reportData.length?'<p class="text-xs text-slate-500 text-center py-2">Belum ada peserta.</p>':"",reportData.forEach((t,n)=>{let a=new Date(t.waktu),i=a.getHours().toString().padStart(2,"0")+":"+a.getMinutes().toString().padStart(2,"0")+" WIB";e.innerHTML+=`<div class="p-2 border border-slate-700 rounded bg-slate-800 flex justify-between items-center"><span class="text-xs text-slate-300 font-bold">${n+1}. ${t.nama}</span><span class="text-[9px] text-slate-500">${i}</span></div>`}))})}function downloadExcel(){if(0===reportData.length)return alert("Data masih kosong.");let e=reportData.map((e,t)=>{let n={No:t+1,"Waktu Absen":new Date(e.waktu).toLocaleString(),"Nama Peserta":e.nama};try{let a=JSON.parse(e.custom);for(let i in a)n[i]=a[i]}catch(l){}return n["Tanda Tangan"]="NO TTD"!==e.ttd?"Tersimpan di PDF":"-",n}),t=XLSX.utils.json_to_sheet(e),n=XLSX.utils.book_new();XLSX.utils.book_append_sheet(n,t,"Rekap_Presensi"),XLSX.writeFile(n,`Presensi_${activeMeeting.code}.xlsx`)}function downloadPDF(){if(0===reportData.length)return alert("Data masih kosong.");let{jsPDF:e}=window.jspdf,t=new e("p","mm","a4"),n=t.internal.pageSize.getWidth(),a=20;if(savedLogoBase64){let i=document.getElementById("logoPreview"),l=i.naturalWidth/i.naturalHeight,d=18,s=d*l;s>40&&(d=(s=40)/l),t.addImage(i,"PNG",14,12,s,d),a=22}t.setFont("helvetica","bold"),t.setFontSize(14),t.text("DAFTAR HADIR PESERTA",n/2,a,{align:"center"}),t.setFont("helvetica","normal"),t.setFontSize(10),t.text("Nama Agenda",14,38),t.text(`: ${activeMeeting.name}`,40,38),t.text("Tempat",14,44),t.text(`: ${activeMeeting.location||"-"}`,40,44),t.text("Tanggal",120,38),t.text(`: ${activeMeeting.date}`,135,38),t.text("Waktu",120,44),t.text(`: ${activeMeeting.time}`,135,44),t.setLineWidth(.5),t.line(14,52,n-14,52);let o=["No","Nama Peserta"];try{let r=JSON.parse(reportData[0].custom);for(let c in r)o.push(c)}catch(m){}o.push("Tanda Tangan");let g=reportData.map((e,t)=>{let n=[t+1,e.nama];try{let a=JSON.parse(e.custom);for(let i in a)n.push(a[i]||"-")}catch(l){}return"NO TTD"!==e.ttd&&e.ttd.startsWith("data:image")?n.push({content:"",styles:{minCellHeight:12},imageBase64:e.ttd}):n.push("-"),n});t.autoTable({startY:56,head:[o],body:g,theme:"grid",headStyles:{fillColor:[230,230,230],textColor:[0,0,0],halign:"center",fontStyle:"bold",lineColor:[0,0,0],lineWidth:.2},styles:{fontSize:8,valign:"middle",textColor:[0,0,0],cellPadding:2,lineColor:[0,0,0],lineWidth:.2},columnStyles:{0:{halign:"center",cellWidth:10}},didDrawCell:function(e){if("body"===e.section&&e.column.index===o.length-1){var n=e.cell.raw;if(n&&n.imageBase64){var a=e.cell.height-4,i=2*a;i>e.cell.width-4&&(a=(i=e.cell.width-4)/2);var l=e.cell.x+(e.cell.width-i)/2,d=e.cell.y+(e.cell.height-a)/2;t.addImage(n.imageBase64,"PNG",l,d,i,a)}}}});let u=t.lastAutoTable.finalY+15;u>250&&(t.addPage(),u=20);let p=new Date().toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"});t.setFontSize(8),t.text(`Dicetak dari Sistem pada: ${p}`,14,u+25),t.save(`Laporan_Presensi_${activeMeeting.code}.pdf`)}function resetView(e,t,n){document.getElementById(e).classList.remove("hidden"),document.getElementById(t).classList.add("hidden"),document.getElementById(n).value=""}document.addEventListener("DOMContentLoaded",()=>{loadAdminState();let e=document.querySelectorAll("#view-admin input, #view-admin select");e.forEach(e=>{e.addEventListener("input",saveAdminState),e.addEventListener("change",saveAdminState)});let t=new URLSearchParams(window.location.search),n=t.get("join");n&&(document.getElementById("inputMeetingCode").value=n,verifyCode())}),document.addEventListener("DOMContentLoaded",()=>{loadAdminState();let e=document.querySelectorAll("#view-admin input, #view-admin select");e.forEach(e=>{e.addEventListener("input",saveAdminState),e.addEventListener("change",saveAdminState)});let t=window.location.hash;if(t&&t.length>7){let n=t.split("-"),a=n[n.length-1].toUpperCase();if(6===a.length){document.getElementById("inputMeetingCode").value="JOIN-"+a,verifyCode();return}}let i=new URLSearchParams(window.location.search),l=i.get("join");l&&(document.getElementById("inputMeetingCode").value=l,verifyCode())});const canvas=document.getElementById("signature-pad"),ctx=canvas.getContext("2d");let isDrawing=!1;function resizeCanvas(){canvas.width=canvas.parentElement.getBoundingClientRect().width,canvas.height=128,ctx.strokeStyle="#0f172a",ctx.lineWidth=3,ctx.lineCap="round",ctx.lineJoin="round"}function getPos(e){let t=canvas.getBoundingClientRect();return e.touches?{x:e.touches[0].clientX-t.left,y:e.touches[0].clientY-t.top}:{x:e.clientX-t.left,y:e.clientY-t.top}}function start(e){e.preventDefault(),isDrawing=!0;let t=getPos(e);ctx.beginPath(),ctx.moveTo(t.x,t.y)}function draw(e){if(!isDrawing)return;e.preventDefault();let t=getPos(e);ctx.lineTo(t.x,t.y),ctx.stroke()}function stop(){isDrawing=!1}function clearCanvas(){ctx.clearRect(0,0,canvas.width,canvas.height)}canvas.addEventListener("mousedown",start),canvas.addEventListener("mousemove",draw),canvas.addEventListener("mouseup",stop),canvas.addEventListener("mouseout",stop),canvas.addEventListener("touchstart",start,{passive:!1}),canvas.addEventListener("touchmove",draw,{passive:!1}),canvas.addEventListener("touchend",stop);