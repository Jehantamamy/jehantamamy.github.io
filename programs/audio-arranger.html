<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Aries PRO DAW - FX Edition</title>
    <!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-2BL3DSGJ4Z"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'G-2BL3DSGJ4Z');
	</script>
    <script src="../assets/js/session-managerm.js"></script>
	<link rel="icon" type="image/png" href="../favicon.png?v=2">
	<script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { overflow: hidden; }
        .daw-container { display: flex; height: calc(100vh - 64px); width: 100vw; }
        
        /* SIDEBAR */
        .track-headers { width: 250px; min-width: 250px; flex-shrink: 0; background: #0f172a; border-right: 1px solid #1e293b; display: flex; flex-direction: column; overflow-y: auto; z-index: 30; }
        /* Ketinggian Header ditambah jadi 160px untuk menampung panel efek */
        .track-header { min-height: 160px; border-bottom: 1px solid #1e293b; padding: 0.5rem; display: flex; flex-direction: column; justify-content: space-between; }
        
        /* ARRANGER */
        .arranger-wrapper { flex-grow: 1; display: flex; flex-direction: column; overflow: hidden; background: #020617; position: relative; min-width: 0; }
        .ruler-container { height: 30px; background: #1e293b; border-bottom: 1px solid #334155; position: relative; overflow: hidden; z-index: 20; }
        .timeline-ruler { height: 100%; position: absolute; left: 0; top: 0; cursor: pointer; }
        .tick-mark { position: absolute; bottom: 0; width: 1px; background: #64748b; }
        .tick-text { position: absolute; bottom: 5px; font-size: 10px; color: #94a3b8; transform: translateX(-50%); }
        .arranger-scroll { flex-grow: 1; overflow: auto; position: relative; }
        .arranger-content { position: relative; min-height: 100%; }
        .bg-grid { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-image: linear-gradient(to right, rgba(255,255,255,0.05) 1px, transparent 1px); pointer-events: none; z-index: 0; }
		.track-lane { height: 160px; border-bottom: 1px solid rgba(255,255,255,0.05); position: relative; }
        
        /* PLAYHEAD & REGION */
        .playhead { position: absolute; top: 0; bottom: 0; width: 2px; background: #ef4444; z-index: 50; pointer-events: none; }
        .playhead-triangle { position: absolute; top: 0; left: -5px; width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-top: 10px solid #ef4444; }
        
        .audio-region { position: absolute; top: 5px; height: 90px; border-radius: 4px; background: rgba(0,0,0,0.6); overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.5); border-style: solid; border-width: 2px; transition: filter 0.2s; cursor: grab; }
        .audio-region:hover { filter: brightness(1.2); }
        .audio-region:active { cursor: grabbing; z-index: 10; }
        .wave-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; opacity: 0.9; }
        
        /* INTERAKSI REGION */
        .cut-line { position: absolute; top: 0; bottom: 0; width: 2px; background: #fff; opacity: 0; pointer-events: none; z-index: 30; box-shadow: 0 0 5px #fff; }
        .audio-region:hover .cut-line { opacity: 0.8; }
        
        .btn-delete-region { position: absolute; top: 2px; right: 2px; width: 18px; height: 18px; background: rgba(225, 29, 72, 0.9); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; cursor: pointer; z-index: 40; opacity: 0; transition: opacity 0.2s; }
        .audio-region:hover .btn-delete-region { opacity: 1; }
        .btn-delete-region:hover { background: rgb(225, 29, 72); transform: scale(1.1); }
        
        .trim-handle { position: absolute; top: 0; bottom: 0; width: 10px; background: rgba(255,255,255,0.3); cursor: ew-resize; z-index: 30; opacity: 0; transition: opacity 0.2s; }
        .audio-region:hover .trim-handle { opacity: 1; }
        .trim-handle:hover { background: rgba(255,255,255,0.6); }
        .trim-handle.left { left: 0; border-right: 1px solid white; }
        .trim-handle.right { right: 0; border-left: 1px solid white; }
		
		/* Efek menyala saat region diklik (Selected) */
        .audio-region.selected { 
            border-color: #fff !important; 
            box-shadow: 0 0 15px rgba(255,255,255,0.8); 
            z-index: 20; 
        }
		
		/* --- TAMBAHAN FADE IN & FADE OUT --- */
        .fade-handle {
            position: absolute; top: 0; width: 0; height: 0; 
            border-left: 6px solid transparent; border-right: 6px solid transparent; border-top: 8px solid white;
            cursor: pointer; z-index: 35; opacity: 0; transition: opacity 0.2s, transform 0.1s; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.8));
        }
        .audio-region:hover .fade-handle { opacity: 0.8; }
        .fade-handle:hover { opacity: 1; transform: scale(1.3); }
        .fade-handle.left { left: 0; transform: translateX(-50%); }
        .fade-handle.right { right: 0; transform: translateX(50%); }
		
		/* --- EFEK TRACK AKTIF --- */
        .track-header { cursor: pointer; transition: background 0.2s, border-left 0.2s; border-left: 4px solid transparent; }
        .track-header.active { border-left-color: #38bdf8; background: #1e293b; }
        .track-lane.active { background: rgba(56, 189, 248, 0.05); }
		
		/* --- TAHAP LOOP: PITA PENGULANG UNGU --- */
        #loop-region {
            position: absolute; top: 0; bottom: 0; 
            background: rgba(168, 85, 247, 0.15); /* Ungu transparan */
            border-left: 2px solid #a855f7; border-right: 2px solid #a855f7;
            z-index: 15; display: none; pointer-events: none;
        }
        .loop-handle {
            position: absolute; top: 0; width: 12px; height: 30px;
            background: #a855f7; cursor: ew-resize; pointer-events: auto;
            display: flex; justify-content: center; align-items: center;
        }
        .loop-handle::after { content: "||"; color: white; font-size: 8px; font-weight: bold; letter-spacing: -1px; }
        .loop-handle.left { left: -6px; border-radius: 4px 0 0 4px; }
        .loop-handle.right { right: -6px; border-radius: 0 4px 4px 0; }
        .loop-bar {
            position: absolute; top: 0; left: 0; right: 0; height: 12px;
            background: rgba(168, 85, 247, 0.4); cursor: grab; pointer-events: auto;
        }
        .loop-bar:active { cursor: grabbing; }
		
		/* --- TAHAP REVERSE: TOMBOL MUNDUR --- */
        .btn-reverse-region { position: absolute; top: 2px; right: 24px; width: 18px; height: 18px; background: rgba(139, 92, 246, 0.9); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 10px; cursor: pointer; z-index: 40; opacity: 0; transition: opacity 0.2s; }
        .audio-region:hover .btn-reverse-region { opacity: 1; }
        .btn-reverse-region:hover { background: rgb(139, 92, 246); transform: scale(1.1); }
		
		/* --- TAHAP FINAL: VOLUME AUTOMATION --- */
        .auto-node { 
            position: absolute; width: 10px; height: 10px; 
            background: #fff; border: 2px solid #38bdf8; border-radius: 50%; 
            transform: translate(-50%, -50%); cursor: grab; z-index: 45; 
            box-shadow: 0 0 5px rgba(56, 189, 248, 0.8);
        }
        .auto-node:active { cursor: grabbing; transform: translate(-50%, -50%) scale(1.5); background: #38bdf8; }
    </style>
</head>
<body class="bg-slate-950 text-slate-200 font-mono select-none">

    <nav class="h-16 bg-slate-900 border-b border-slate-800 px-4 flex justify-between items-center shadow-lg">
        <h1 class="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-sky-400 to-emerald-400">
            <i class="fa-solid fa-layer-group text-sky-400"></i> ARIES PRO DAW
        </h1>
        
        <div class="flex items-center gap-4">
            <div class="bg-black border border-slate-700 px-3 py-1 rounded text-sky-400 font-bold tracking-widest text-lg min-w-[100px] text-center" id="time-display">00:00.0</div>
            <button onclick="playGlobal()" id="btn-master-play" class="bg-emerald-600 hover:bg-emerald-500 w-10 h-10 rounded-full text-white flex items-center justify-center transition shadow-[0_0_15px_rgba(16,185,129,0.3)]">
                <i class="fa-solid fa-play ml-1"></i>
            </button>
            <button onclick="stopGlobal()" class="bg-slate-700 hover:bg-slate-600 w-10 h-10 rounded-full text-white flex items-center justify-center transition">
                <i class="fa-solid fa-stop"></i>
            </button>
			<button id="btn-loop" onclick="toggleLoop()" class="w-8 h-8 rounded bg-slate-700 hover:bg-slate-600 text-slate-300 transition shadow ml-2" title="Loop / Cycle Mode (Pengulangan)">
                <i class="fa-solid fa-repeat"></i>
            </button>
        </div>
		<div class="flex items-center gap-2 ml-4 pl-4 border-l border-slate-700" title="Master Level Meter">
			<span class="text-[8px] text-slate-400 font-bold tracking-widest flex flex-col items-end leading-none">
				<span>MASTER</span>
				<span class="text-emerald-400">OUT</span>
			</span>
			<div class="w-24 h-5 bg-slate-900 rounded overflow-hidden relative flex flex-col justify-between py-0.5 px-0.5 border border-slate-700 shadow-inner">
				<canvas id="vu-meter-l" width="92" height="8"></canvas>
				<canvas id="vu-meter-r" width="92" height="8"></canvas>
			</div>
		</div>
		<div class="flex items-center gap-2 ml-2 mr-2 border-l border-slate-700 pl-4">
			<span class="text-[10px] text-slate-400 font-bold tracking-widest">BPM</span>
			<input type="number" id="bpm-input" value="120" class="w-14 bg-slate-800 text-sky-400 text-xs text-center rounded px-1 py-1 border border-slate-700 outline-none">
			
			<button id="btn-snap" class="w-8 h-8 rounded bg-slate-700 hover:bg-slate-600 text-slate-300 transition shadow" title="Snap to Grid (Magnet)">
				<i class="fa-solid fa-magnet"></i>
			</button>
			
			<button id="btn-metronome" class="w-8 h-8 rounded bg-slate-700 hover:bg-slate-600 text-slate-300 transition shadow" title="Metronome (Tik-Tok)">
				<i class="fa-solid fa-bell"></i>
			</button>
		</div>
		
        <div class="flex items-center gap-2">
            <button onclick="saveProject()" class="bg-indigo-600 hover:bg-indigo-500 px-3 py-2 rounded text-white font-bold text-[10px] transition shadow" title="Simpan Project (.aries)">
                <i class="fa-solid fa-floppy-disk"></i> SAVE PROJ
            </button>
            <button onclick="document.getElementById('load-project-input').click()" class="bg-slate-700 hover:bg-slate-600 px-3 py-2 rounded text-white font-bold text-[10px] transition shadow" title="Buka Project">
                <i class="fa-solid fa-folder-open"></i> LOAD
            </button>
            <input type="file" id="load-project-input" accept=".aries" class="hidden" onchange="loadProject(this)">
            <div class="flex items-center gap-1 ml-2 border-l border-slate-700 pl-3">
                <select id="export-format" class="bg-slate-800 text-[10px] text-sky-400 font-bold py-2 px-2 rounded border border-slate-700 outline-none cursor-pointer">
                    <option value="wav">.WAV (HQ)</option>
                    <option value="webm">.WEBM (LQ)</option>
                </select>
                <button onclick="exportAudio()" id="btn-export" class="bg-rose-600 hover:bg-rose-500 px-3 py-2 rounded text-white font-bold text-[10px] transition shadow" title="Export Audio">
                    <i class="fa-solid fa-file-audio"></i> EXPORT
                </button>
            </div>
        </div>
		
		<div class="flex items-center gap-4">
            
            <div class="flex items-center gap-2 text-xs text-slate-400 ml-4">
                <i class="fa-solid fa-magnifying-glass-minus"></i>
                <input type="range" id="zoom-slider" min="10" max="200" value="50" class="w-24 accent-sky-500">
                <i class="fa-solid fa-magnifying-glass-plus"></i>
            </div>
            <button onclick="addTrack()" class="bg-sky-600 hover:bg-sky-500 px-4 py-2 rounded text-white font-bold text-xs transition">
                <i class="fa-solid fa-plus"></i> TRACK
            </button>
			<button onclick="openHelp()" class="bg-slate-800 hover:bg-slate-700 px-3 py-2 rounded text-slate-300 font-bold text-xs transition border border-slate-600 ml-2 shadow" title="Keyboard Shortcuts">
                <i class="fa-solid fa-keyboard"></i> 
            </button>
        </div>
    </nav>

    <div class="daw-container">
        <div class="track-headers" id="track-headers-container"></div>
        <div class="arranger-wrapper">
            <div class="ruler-container"><div class="timeline-ruler" id="ruler" onmousedown="startDragPlayhead(event)"><div class="playhead" id="playhead-top"><div class="playhead-triangle"></div></div></div></div>
            <div class="arranger-scroll" id="arranger-scroll" onscroll="syncScroll()">
                <div class="arranger-content" id="arranger-content">
                    <div class="bg-grid" id="bg-grid"></div>
                    <div class="playhead" id="playhead-main"></div>
                    <div id="track-lanes-container"></div>
                </div>
            </div>
        </div>
    </div>
	
	<div id="help-modal" class="fixed inset-0 bg-black/80 z-[100] hidden flex items-center justify-center backdrop-blur-sm transition-opacity">
        <div class="bg-slate-900 border border-slate-700 rounded-lg shadow-2xl p-6 w-[450px] max-w-[90vw] text-slate-300 relative">
            <button onclick="closeHelp()" class="absolute top-4 right-4 text-slate-500 hover:text-white transition">
                <i class="fa-solid fa-times text-xl"></i>
            </button>
            <h2 class="text-xl font-bold text-sky-400 mb-4 border-b border-slate-700 pb-2"><i class="fa-solid fa-keyboard mr-2"></i> Keyboard Shortcuts & Panduan</h2>
            
            <div class="space-y-3 text-sm">
                <div class="flex justify-between border-b border-slate-800 pb-1">
                    <span class="font-bold text-emerald-400">Spacebar (Spasi)</span>
                    <span>Play / Stop Audio</span>
                </div>
                <div class="flex justify-between border-b border-slate-800 pb-1">
                    <span class="font-bold text-sky-400">Ctrl + Z</span>
                    <span>Undo (Batal)</span>
                </div>
                <div class="flex justify-between border-b border-slate-800 pb-1">
                    <span class="font-bold text-sky-400">Ctrl + Y / Shift+Ctrl+Z</span>
                    <span>Redo (Maju)</span>
                </div>
                <div class="flex justify-between border-b border-slate-800 pb-1">
                    <span class="font-bold text-amber-400">Double Click Kotak</span>
                    <span>Potong Audio (Split Pisau)</span>
                </div>
                <div class="flex justify-between border-b border-slate-800 pb-1">
                    <span class="font-bold text-amber-400">Drag Ujung Kiri/Kanan</span>
                    <span>Trim (Mengubah Panjang Audio)</span>
                </div>
                <div class="flex justify-between border-b border-slate-800 pb-1">
                    <span class="font-bold text-white">Drag Sudut Atas Putih</span>
                    <span>Fade In / Fade Out Animasi</span>
                </div>
                <div class="flex justify-between border-b border-slate-800 pb-1">
                    <span class="font-bold text-rose-400">Ctrl + C</span>
                    <span>Copy Kotak Audio Terpilih</span>
                </div>
                <div class="flex justify-between border-b border-slate-800 pb-1">
                    <span class="font-bold text-rose-400">Ctrl + V</span>
                    <span>Paste Kotak Audio ke Garis Merah</span>
                </div>
                <div class="flex justify-between">
                    <span class="font-bold text-rose-400">Delete / Backspace</span>
                    <span>Hapus Kotak Audio Terpilih</span>
                </div>
            </div>
            
            <div class="mt-6 text-center text-[10px] text-slate-500 tracking-widest font-bold">
                ARIES PRO DAW ENGINE
            </div>
        </div>
    </div>
	
    <script src="../assets/js/audiom.js">
      
    </script>
</body>
</html>